# Estado del Proyecto PerPel - 23 de Febrero, 2026

## ‚úÖ Logros de Hoy
### 1. Infraestructura de Datos y Seguridad
- **Encriptaci√≥n AES-256**: Implementada mediante `pgcrypto`. Todas las credenciales (`access_token`, `refresh_token`) se cifran autom√°ticamente v√≠a Triggers antes de guardarse.
- **Acceso Blindado**: Creada funci√≥n RPC `core.get_business_credentials` con permisos restringidos solo para el `service_role` (Backend).
- **Modelo Multi-Sucursal**: Tablas `core.business_credentials` y `core.business_asign_credentials` creadas para permitir m√∫ltiples integraciones API por negocio.

### 2. Punto de Venta (POS) y Offline
- **RxDB Optimizado**: Base de datos local actualizada (`perpel_db_v4`) con esquemas para `inventory_items`, `stock_levels` y `customers`.
- **Gesti√≥n de Clientes**:
    - Buscador Autocomplete en el POS (Nombre/Documento).
    - Visualizaci√≥n protegida (solo √∫ltimos 3 d√≠gitos del documento).
    - Alta r√°pida de clientes desde el POS con soporte offline.
- **Lector de C√≥digo de Barras**: Hook `useBarcodeScanner` integrado con b√∫squeda escalonada (RxDB -> Supabase).
- **Flujo "Pagar Despu√©s"**: Implementado en el hook `usePOS` y en la UI de cobro.

### 3. Experiencia de Usuario (UX)
- **Precarga de Categor√≠as**: Utilidad `seedInitialCategories` integrada en el Dashboard para configurar autom√°ticamente rubros de Perfumer√≠a y Peluquer√≠a (Extensible a Almac√©n).
- **Sincronizaci√≥n Inicial**: Al entrar al Dashboard, se disparar el `pullData` para llenar RxDB con la info del servidor.

## üöÄ Plan para Ma√±ana
### Fase 4: Frontend y Flujo OAuth
- Implementar el bot√≥n "Conectar con Mercado Pago" en el panel de credenciales.
- Crear el componente `OAuthCallback` para recibir el `code` de las APIs.
- Mostrar estado de conexi√≥n (Activo / Expirado) en la interfaz.

### Fase 5: L√≥gica de Renovaci√≥n (Backend)
- Crear Edge Function para intercambio de tokens (Token Manager).
- Implementar rutina de "Auto-Refresh" antes de procesar pagos si el token est√° por vencer.

## ‚ö†Ô∏è Notas y Recordatorios
- **is_deleted**: Se ha estandarizado el uso de esta columna para borrado l√≥gico en todos los archivos modificados.
- **Migraciones**: Ma√±ana verificar que todas las tablas de asignaci√≥n tengan sus pol√≠ticas RLS activas para el rol `ADMIN`.
- **Limpieza**: Pendiente correr script de eliminaci√≥n de tablas de `pgsodium` hu√©rfanas tras validar AES.
